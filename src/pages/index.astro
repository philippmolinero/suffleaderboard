---
import BaseLayout from '../layouts/BaseLayout.astro';
import data from '../data/data.json';

const today = new Date();
const endDate = new Date('2025-06-01');
const daysLeft = Math.ceil((endDate.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));
const penalytSum = data.reduce((sum, obj) => sum + obj.strafe, 0);

// Sort in ascending order - by suff property
const sortedPlayerAsc = data.sort((a, b) => b.suff - a.suff );
const pageTitle = 'Abstinenz Ranking';

// explain how to get the icon
const getIcon = (index, totalPlayers) => {
    if (index === totalPlayers - 1) { // Handle last place separately
        return '😭';
    }
    switch (index) {
        case 0:
            return '🥇';
        case 1:
            return '🥈';
        case 2:
            return '🥉';
        default:
            return '';
    }
};


---

<BaseLayout pageTitle={pageTitle}>
  <div class="container">
      <div class="content">
          <div class="header">
              <div class="trophy">🏆</div>
              <h2 class="title">Abstinenz Ranking</h2>
          </div>
          <div style="text-align: center;">
              <h2 style="text-align: center;">Noch {daysLeft} Tage!</h2>
              <h3>Gemeinschaftskasse: {penalytSum} EUR</h3>
            </div>
          <div class="card">
              <table>
                  <thead>
                      <tr>
                          <th style="width: 96px;"></th>
                          <th>Name</th>
                          <th>x Suff</th>
                          <th>Joker</th>
                          <th style="text-align: center;">Strafkonto</th>
                      </tr>
                  </thead>
                  <tbody>
                    {sortedPlayerAsc.map((player, index) => (
                        <tr>
                            {<td style="width: 96px;"><p>{getIcon(index, sortedPlayerAsc.length)}</p></td>}
                            <td><p>{player.name}</p></td>
                            <td><p>{player.suff}</p></td>
                            <td><p>{player.joker}</p></td>
                            <td style="text-align: center;"><p>{player.strafe} EUR</p></td>
                        </tr>
                        ))}
                  </tbody>
              </table>
          </div>
      </div>
  </div>
</BaseLayout>